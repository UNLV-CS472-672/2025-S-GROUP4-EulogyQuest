# ai-gen start (ChatGPT-4o, 1)
name: Perl Lint

on:
  pull_request:
    branches: [master]

jobs:
  perl_lint:
    name: 🔎 Perl::Lint
    runs-on: ubuntu-latest

    steps:

      - name: Communicate start
        run: echo "Perl Lint workflow started!"

      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Perl
        uses: shogo82148/actions-setup-perl@v1
        with:
          perl-version: '5.36'

      - name: Install Perl::Lint
        run: |
          cpanm --notest Perl::Lint

      - name: Run Perl::Lint
        run: |
          echo "Running Perl::Lint..."
          find . \( -name '*.pl' -o -name '*.pm' -o -name '*.t' \) -print0 | while IFS= read -r -d '' file; do
            echo "Checking $file"
            perl -MPerl::Lint::Linter -e '
              my $file = $ARGV[0];
              my $linter = Perl::Lint::Linter->new;
              my $res = $linter->lint($file);
              foreach my $v (@$res) {
                printf "%s:%d:%d %s\n",
                  $file,
                  $v->{line},
                  $v->{column},
                  $v->{message};
              }
            ' "$file"
          done
# ai-gen end